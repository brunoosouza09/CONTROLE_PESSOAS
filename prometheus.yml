# ============================================
# Configuração do Prometheus
# ============================================
# Este arquivo configura o Prometheus para coletar
# métricas da aplicação de Cadastro de Pessoas

global:
  # Intervalo de coleta de métricas (15 segundos)
  scrape_interval: 15s
  
  # Intervalo de avaliação de regras de alerta
  evaluation_interval: 15s
  
  # Labels externas aplicadas a todas as métricas
  external_labels:
    monitor: 'cadastro-pessoas'
    environment: 'production'

# ============================================
# Configurações de Scraping (Coleta de Métricas)
# ============================================
scrape_configs:
  # Job: Aplicação Node.js
  - job_name: 'cadastro-pessoas'
    
    # Configuração estática de targets (alvos)
    static_configs:
      # URL do serviço Docker (nome do container)
      # Porta 3000 é onde a aplicação Node.js está rodando
      - targets: ['controle_pessoas_app:3000']
        labels:
          service: 'api'
          instance: 'cadastro-pessoas-1'
    
    # Caminho do endpoint de métricas
    metrics_path: '/metrics'
    
    # Intervalo específico para este job (opcional)
    scrape_interval: 15s
    
    # Timeout para cada scraping
    scrape_timeout: 10s
    
    # Métricas HTTP básicas do Prometheus
    # (opcional - descomente se quiser métricas HTTP adicionais)
    # metrics_relabel_configs:
    #   - source_labels: [__name__]
    #     regex: 'http.*'
    #     action: keep

  # Job: Prometheus (monitoramento do próprio Prometheus)
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'
